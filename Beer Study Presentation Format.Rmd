---
title: "Beer Study"
author: "Steve Bramhall, Lei Jiang"
date: "October 16, 2018"
output: 
  ioslides_presentation:
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Agenda

- Review Breweries by State
- Beer & Brewery Data Merge - Begining Data
- Beer & Brewery Data Merge - Ending Data
- Missing Data
- Median Alcohol By Volmue (ABV) by State
- Median International Bitterness Unit (IBU) by State
- State with Highest ABV Beer
- State with Highest IBU Beer
- ABV Summary
- ABV vs IBU
- Conclusion

```{r message=FALSE, warning=FALSE, echo = FALSE}

#--- Load libraries and data files---

# Load Libraries
library(dplyr)      # for string functions
library(ggplot2)    # for plots
library(kableExtra) # for table formatting
library(knitr)      # for presenting in html
```

```{r echo = FALSE}

# Read beer data from csv file and put into beerDF data frame.Then rename columns to be more readable.
beerDF <- read.csv(".\\ImportFiles\\Beers.csv",header=TRUE,sep=",",stringsAsFactors = TRUE, encoding = "UTF-8")
names(beerDF) <- c("BeerName","BeerID","AlcoholByVolume","BitternessUnits","BreweryID",
                   "BeerStyle","Ounces")                                                                       # rename table columns

# Read brewery data from csv file and put into breweryDF data frame.Then rename columns to be more readable.
breweryDF <- read.csv(".\\ImportFiles\\Breweries.csv",header=TRUE,sep=",",stringsAsFactors = FALSE)
names(breweryDF) <- c("BreweryID","BreweryName","City","State")                                                # rename table columns
```

## Breweries by State

```{r fig.align="center", message=FALSE, warning=FALSE, echo = FALSE}

#Q1 Obtain number of breweries in each state using group_by function in library dplyr,
#  then show data with the summarize function
breweryStateCnt <- group_by(breweryDF,State)                   # get brewery count by state
brewerySummaryDF <- summarize(breweryStateCnt,count=n())       # put data into a dataframe for easier manipulation

#create a histogram for Breweries by State
ggplot(data=brewerySummaryDF, aes(x=reorder(State,-count), y=count)) + 
  geom_histogram(stat="identity", col="black", aes(fill=count)) + coord_flip()+             # make horizontal plot
  theme(axis.text.y=element_text(size=6)) +                                                 # decrease axis font
  labs(title="Fig 1 - Breweries by State",x="State",y="Breweries") +                                                           # add axes titles
  theme(plot.title = element_text(color="dark blue",hjust=0.5)) +                           # format main title
  geom_text(size=2, aes(label=count), position=position_dodge(width=1), hjust=-1.0) +       # format plot text data
  scale_fill_gradient2("Number per State", low = "sky blue", mid="light blue", high = "blue", midpoint=20) # set color scheme
```

## States with Most Breweries Per Person
<center>
Fig 2 - States with Most Breweries Per Person
![States with Most Breweries Per Person](.\\ImportFiles\\rsz_statesmostbreweriesperperson2.jpg)


<font size="1">Ref <https://priceonomics.com/where-is-craft-beer-most-popular-in-america/></font>
</center>

## Beer and Brewery Data Merge | Beginning Data {.smaller}

```{r message=FALSE, warning=FALSE, echo = FALSE}
#Q2 The code merged brewery and beer data into the brewDataDF data frame
allBeerDataDF <- merge.data.frame(breweryDF,beerDF,by="BreweryID")
#write.table(allBeerDataDF,".\\OutputFiles\\MergedBeerData1.csv",quote=FALSE,sep=',',row.names=FALSE)

# Print the first 6 lines of the merged beer & brewery data
kable(head(allBeerDataDF,6),format="html",caption="Table 2 - Merged beer and brewery data (BEGINNING OF DATA)",align='c',row.names = F) %>%
    kable_styling(latex_options="scale_down",bootstrap_options = "striped")
#    kable_styling(font_size=4,bootstrap_options = "striped", "condensed")
```

## Beer and Brewery Data Merge | Ending Data {.smaller}
```{r message=FALSE, warning=FALSE, echo = FALSE}
# Print the last 6 lines of the merged beer & brewery data
kable(tail(allBeerDataDF,6),format="html",caption="Table 3 - Merged beer and brewery data (END OF DATA)",align='c', row.names = F) %>%
  kable_styling(font_size=4,bootstrap_options = "striped", "condensed")
```

## Missing Data
```{r message=FALSE, warning=FALSE, echo = FALSE}
#Q3 Reporting NA count, put in data frame for easier display options
naCountDF <-as.data.frame(sapply(allBeerDataDF, function(x) sum(length(which(is.na(x))))))
names(naCountDF) <- ("NA Count") # rename columns

# Print the NA Counts by State
kable(naCountDF,format="html", caption="Table 4-NA Count by Variable (NA=blanks)",align='c') %>% 
  kable_styling(bootstrap_options = "striped", full_width = F)
```

## Median Alcohol By Volume (ABV) by State
```{r fig.align="center", message=FALSE, warning=FALSE, echo = FALSE}
#Q4 Creating DF for median Alcohol by Volume (ABV) and International Bitterness Units (IBU)
#   NA's are ignored in calculations, and associated state is inlcuded in the data frame
medianABV <- aggregate(allBeerDataDF$AlcoholByVolume, list(allBeerDataDF$State), median, na.rm=TRUE)
names(medianABV) <- c("State","MedianAlcoholByVolume") # Add Column Names
medianIBU <- aggregate(allBeerDataDF$BitternessUnits, list(allBeerDataDF$State), median, na.rm=TRUE)
names(medianIBU) <- c("State","MedianBitternessUnits") # Add Column Names

medianBeerData <- merge(medianABV,medianIBU,"State")   # Merge median ABV & IBU into one DF 

# Plot ABV by State, flip axes for easier reading, sort by ABV, called Figure 2.
ggplot(medianBeerData) + 
  aes(x=reorder(State,-MedianAlcoholByVolume),y=MedianAlcoholByVolume,fill=MedianAlcoholByVolume,na.omit=TRUE) +   
  geom_bar(stat="identity") + coord_flip() +                                                # make hoizontal plot
  theme(axis.text.y=element_text(size=6)) +                                                 # decrease axis font
  labs(title = "Fig 2 - Median ABV by State",x="State",y="Median Alcohol by Volume (ABV)") +# add axes titles
  theme(plot.title = element_text(color="dark blue",hjust=0.5)) +                           # format main title
  theme(axis.title.x = element_text(color="dark blue")) +                                   # format x title
  theme(axis.title.y = element_text(color="dark blue")) +                                   # format y title
  guides(fill=guide_legend("Alcohol By Volume")) +                                          # label legend
  scale_fill_gradientn(colours = rainbow(3))
```

## Median International Bitterness Unit (IBU) by State
```{r fig.align="center", message=FALSE, warning=FALSE, echo = FALSE}
# Plot IBU by State, flip axes for easier reading, sort by IBU, called Figure 3.
ggplot(medianBeerData) + 
  aes(x=reorder(State,-MedianBitternessUnits),y=MedianBitternessUnits,fill=MedianBitternessUnits,na.omit=TRUE) +   
  geom_bar(stat="identity") + coord_flip() +                                                # make hoizontal plot
  theme(axis.text.y=element_text(size=6)) +                                                 # decrease axis font
  labs(title = "Fig 3 - Median IBU by State",x="State",y="Median International Bitternesss Units (IBU)") + # add axes titles
  theme(plot.title = element_text(color="dark blue",hjust=0.5)) +                           # format main title
  theme(axis.title.x = element_text(color="dark blue")) +                                   # format x title
  theme(axis.title.y = element_text(color="dark blue")) +                                   # format y title
  guides(fill=guide_legend("Bitterness Units")) +                                           # label legend
  scale_fill_gradientn(colours = rainbow(4))
```

## State with Highest ABV {.smaller}
```{r message=FALSE, warning=FALSE, echo = FALSE}
#Q5 Identifying state with max ABV (alcohol) & IBU (bitterness)

# Print Info about State with the Most Alcohol by Volume
kable(allBeerDataDF[which.max(allBeerDataDF$AlcoholByVolume),],format="html", 
      caption="Table 5 - State with the Most Alcohol by Volume (ABV)",align='c',row.names=F) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F)
```
<div class=white>
Space between table and text
Space between table and text
</div>
<div class=black>
The state with the maximum alcoholic beer is Colorado. It has a 0.128 ABV and comes from the Upslope Brewing Company. The beer is the Lee Hill Series Vol. 5, a Belgian Style Quadrupel Ale.
</div>

## State with Highest IBU Beer {.smaller}
```{r message=FALSE, warning=FALSE, echo = FALSE}
kable(allBeerDataDF[which.max(allBeerDataDF$BitternessUnits),],format="html", 
      caption="Table 6 - State with the Highest International Bitterness Units (IBU)",align='c',row.names=F) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F)
```
<div class=white>
Space between table and text
Space between table and text
</div>
<div class=black>
The state with the highest bitterness beer score is Oregon. It has a 138 IBUs and comes from the Astoria Brewing Company. The beer is the Bitter Bitch Imperial IPA, an American Double/Imperial IPA.
</div>

## ABV Summary
```{r message=FALSE, warning=FALSE, echo = FALSE}
#Q6 Below are the summary statistics for the Achohol By Volume (ABV)
kable(t(summary(allBeerDataDF$AlcoholByVolume)),format="html",                                          # used transpose function to get desired format
      caption="Table 7 - Summary Statistics for Alcohol By Volume (ABV)",align='c',row.names=F) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F)

boxplot(allBeerDataDF$AlcoholByVolume, main="Fig 4 - Alcohol By Volume Boxplot", xlab="All ABV Data", ylab="ABV",col="lightblue")
```

## ABV vs IBU
```{r fig.align="center", message=FALSE, warning=FALSE, echo = FALSE}
#Q7 Is there an apparent relationship between the bitterness fo the beer and its alcoholic content

scatterplot <- ggplot(allBeerDataDF, aes(BitternessUnits, AlcoholByVolume,col=AlcoholByVolume)) +
  geom_point() + coord_flip() +                                                             # make horizontal scatter plot
  ggtitle("Fig 5 - ABV and IBU") +                                                          # add title
  theme(plot.title = element_text(color="dark blue",hjust=0.5)) +                           # format main title
  xlab("Alcohol Content") +  ylab("Bitterness") +                                           # add axis labels
  theme(axis.title.x = element_text(color="dark blue")) +                                   # format x title
  theme(axis.title.y = element_text(color="dark blue"))                                     # format y title

#fit data by lm to scatterplot
scatterplot+geom_smooth(method = "lm", colour = "black", fill="yellow")
```
<center><div class="green">
r = 0.671, positive linear correlation
$$r^{2} = 0.4502$$
</div></center>

## Conclusion

- *Set the Significance level, alpha = 0.05*
- *Ran a Pearson R Correlation using RStudio*
- *P-value < 2.2e-18, the correlation is statistically significant.*
- *So as the alcohol by volume increases, there is a tendancy for the bitterness to increase as well.*
- *This is an observational study so teh analysis is limited to teh population of this study.*

## BACKUP
```{r message=FALSE, warning=FALSE, echo = TRUE}
cor.test(allBeerDataDF$AlcoholByVolume, allBeerDataDF$BitternessUnits)
```
